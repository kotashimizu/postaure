# Postaure リリース向け要件定義書
作成日: 2025-03-08
版数: 1.0
作成者: Codex (GPT-5)
リポジトリ: postaure
対象リリース: v1.0.0 (Public Beta)

---

## 1. プロジェクト概要
- 名称: Postaure - Advanced Posture Analysis Application
- 目的: MediaPipe 技術を活用して姿勢解析とレポート作成を提供し、専門家とセルフユーザーの姿勢改善を支援する。
- 提供形態: Web アプリケーション (PWA 対応)
- 対象プラットフォーム: Chrome 90+, Edge 90+, Safari 14+, Firefox 88+

## 2. 背景とビジネスゴール
- 姿勢評価業務の効率化と質の向上。
- セルフケア向けのエビデンスベース指標を提供。
- 差別化要素: Kendall 法準拠、AI レポート生成、ローカル処理によるプライバシー保護。
- リリースゴール: ベータ版として主要機能を提供しフィードバックを収集する。

## 3. リリース範囲
- 対象機能:
  1. ブラウザ互換性チェック/デバイス適応
  2. カメラ撮影および画像アップロードでの前額面・矢状面取得
  3. MediaPipe によるランドマーク検出
  4. Kendall 法準拠の姿勢解析・詳細メトリクス
  5. 解析結果の可視化と PDF/PNG/JSON エクスポート
  6. Web Share API とフォールバックによる共有
  7. Service Worker によるオフライン対応
  8. AI レポート生成 (API 設定済み時)
- 対象外 (今後検討): 3D/動画解析、クラウド同期、医療システム連携

## 4. ステークホルダー
- プロダクトオーナー: kota5656
- 開発: Codex エージェント + コントリビュータ
- QA/テスター: プロジェクトメンバー
- 運用/サポート: プロダクトオーナー
- 外部 API 提供者: OpenAI/Anthropic/その他 (任意)

## 5. 用語定義
- 前額面: 正面姿勢画像
- 矢状面: 側面姿勢画像
- Kendall 法: 「Posture and Pain」に基づく姿勢分類
- CVA: Cranio-Vertebral Angle
- MediaPipe Tasks Vision: Google の姿勢推定 WebAssembly モジュール

## 6. ユーザータイプ
1. 医療・フィットネス専門家
2. セルフケアユーザー
3. 学習者・トレーニー

## 7. 前提条件・制約
- WebRTC カメラアクセスと JavaScript 実行が可能なブラウザ。
- 初回ロードで MediaPipe WASM を取得するためネットワークが必要。
- AI レポート利用には API キーと CORS 設定が必要。
- PWA 利用には HTTPS 配信が必須。
- ファイルエクスポートはブラウザのダウンロード機能に依存。

## 8. ユースケース
| ID | シナリオ | アクター | 概要 | 成功条件 |
|----|----------|---------|------|-----------|
| UC-01 | 初回互換性確認 | 全ユーザー | ブラウザ/デバイス対応状況を判定 | 判定結果を表示し次フェーズへ遷移 |
| UC-02 | カメラ撮影 | 専門家/セルフ | 前額面→矢状面の順に撮影 | 2 枚取得して解析へ進む |
| UC-03 | 画像アップロード | 全ユーザー | 撮影不可時に既存画像を利用 | 2 枚アップ後解析へ進む |
| UC-04 | 姿勢解析 | システム | MediaPipe 解析と Kendall 指標算出 | 解析結果を生成 |
| UC-05 | レポート閲覧/エクスポート | 全ユーザー | 結果表示と PDF/PNG/JSON 出力 | ダウンロード成功 |
| UC-06 | AI レポート生成 | 専門家 | API 設定済みで高度分析を取得 | AI レポート表示 |
| UC-07 | オフライン利用 | セルフケア | 接続断でもキャッシュから基本機能利用 | オフライン通知下で操作継続 |

## 9. 機能要件
| ID | 要件 | 詳細/優先度 | 受入基準 |
|----|------|-------------|-----------|
| FR-01 | 互換性チェック | 必須 | MediaPipe/WebGL 未対応時に警告 |
| FR-02 | デバイス適応 | 必須 | UI スケール/品質が端末に応じて変化 |
| FR-03 | カメラ撮影 | 必須 | 前額面・矢状面の連続撮影が完了 |
| FR-04 | 画像アップロード | 必須 | 画像寸法を取得し解析に渡せる |
| FR-05 | 姿勢解析 | 必須 | MediaPipe 検出と Kendall 指標が生成 |
| FR-06 | 詳細レポート表示 | 必須 | UI に全セクションが描画される |
| FR-07 | エクスポート | 必須 | PDF/PNG/JSON を保存可能 |
| FR-08 | 共有 | 準必須 | Web Share/API フォールバックで共有成功 |
| FR-09 | AI レポート | 準必須 | API 設定済みでレポート生成 |
| FR-10 | オフライン対応 | 準必須 | Service Worker が offline.html/解析フォールバック提供 |
| FR-11 | エラーハンドリング | 必須 | ErrorBoundary/ErrorMessage が動作 |
| FR-12 | 設定・開発ツール | 任意 | DEV 時に設定/テスト UI 起動 |

## 10. 非機能要件
### 10.1 パフォーマンス
- 初期ロード 3 秒以内 (3G 環境目安)
- 解析完了まで 30 秒以内
- メモリ使用量 100MB 以下目標

### 10.2 セキュリティ/プライバシー
- 画像・解析データはローカル処理のみ
- AI API 送信時はユーザー同意必須
- ダウンロードファイルはローカル保存

### 10.3 アクセシビリティ
- WCAG 2.1 AA 準拠を目標
- スクリーンリーダー/キーボード操作対応

### 10.4 可用性
- オフライン通知と自動再同期
- キャッシュ破損時の復旧ロジック

### 10.5 ローカライズ
- 初期言語: 日本語
- 将来: 英語対応を想定

### 10.6 運用性
- コンソールログで初期化・失敗を記録
- 設定画面で API エンドポイント管理

## 11. データ要件
- 永続化: localStorage (互換性フラグ/API設定)、キャッシュストレージ (WASM/静的資産)
- 保管対象: 解析オブジェクト (メモリ)、エクスポートファイル (ローカルダウンロード)

## 12. 運用・保守要件
- GitHub Issues で不具合管理
- 依存ライブラリは四半期ごとに見直し
- Service Worker バージョン更新時はキャッシュ名と同期

## 13. リリース判定基準
- UC-01〜UC-07 が手動テストで成功
- `npm run build` `npm run lint` が成功
- 主要ブラウザで互換性チェックが完全/部分対応
- オフライン時に offline.html と基本機能が動作
- PDF/PNG/JSON エクスポート内容が仕様通り

## 14. リスクと対策
| リスク | 影響 | 対策 |
|--------|------|------|
| MediaPipe CDN 障害 | 解析不可 | オフラインキャッシュ・リトライ |
| 大容量画像 | パフォーマンス低下 | 画像圧縮・ガイドライン提示 |
| AI API 失敗 | レポート生成不可 | エラー通知と再試行ガイド |
| API キー流出 | セキュリティ問題 | ストレージクリア手順提示 |

## 15. 将来拡張
- 3D/動画解析
- マルチユーザー/クラウド同期
- エクササイズ動画/AR 連携
- 電子カルテ連携

---

本書は v1.0.0 リリースまでの開発・テスト計画の基礎とする。
